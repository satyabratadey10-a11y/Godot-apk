name: Shrink Android Templates Only

on:
  push:             # ğŸŸ¢ Triggers automatically when you save this file
  workflow_dispatch: # ğŸ”µ Allows manual trigger

jobs:
  surgery-and-compress:
    runs-on: ubuntu-latest

    steps:
      - name: Install Tools ğŸ› ï¸
        run: sudo apt-get update && sudo apt-get install -y p7zip-full unzip zip

      - name: Download Original Templates ğŸ“¥
        run: |
          # We use the -O flag to force the output filename to 'templates.tpz'
          # CRITICAL: The URL is wrapped in quotes " " to handle the ? and & symbols
          wget -O templates.tpz "https://downloads.godotengine.org/?version=4.6&flavor=stable&slug=export_templates.tpz&platform=templates"
          
          # Print the size. If this is small (like 4KB), the link is still broken.
          # If it is big (1GB+), we are good to go!
          ls -lh templates.tpz

      - name: Perform Surgery (Delete Non-Android) ğŸ”ª
        run: |
          # 1. Unzip the TPZ
          unzip templates.tpz -d extracted_data
          
          # 2. Go into the folder
          cd extracted_data/templates
          
          # 3. DELETE everything that is NOT Android
          # This removes Windows, Mac, Linux, Web, and iOS files
          rm -f windows* linux* macos* web* ios*
          
          # 4. Show what is left (Should be much cleaner now)
          ls -lh

      - name: Repack and Compress ğŸ—œï¸
        run: |
          # 1. Zip the remaining Android files back into a TPZ
          cd extracted_data
          zip -r ../android_only_templates.tpz templates
          cd ..
          
          # 2. Compress that new tiny TPZ into a 7z for maximum saving
          # Ultra settings, No encryption
          7z a -t7z -m0=lzma2 -mx=9 -mfb=64 -md=64m -ms=on android_templates_minimal.7z android_only_templates.tpz
          
          # 3. Final size check
          ls -lh android_templates_minimal.7z

      - name: Upload Artifact ğŸ“¤
        uses: actions/upload-artifact@v4
        with:
          name: Android-Only-Templates
          path: android_templates_minimal.7z
          retention-days: 1
